---
import fs from 'fs';
import path from 'path';
import MainLayout from '../layouts/MainLayout.astro';

// Get the highlights photos - EXACT ORDER AND SIZES from WordPress site
const highlightsDir = path.join(process.cwd(), 'public/highlights');

// Define photos with exact sizes matching WordPress site
// Sizes: regular (1x1), wide (2x1), tall (1x2), wide_tall (2x2), quad (2x2 but taller)
const highlightPhotos = [
  // Column 1 - Left (2 stacked portraits)
  {
    src: '/highlights/dixit_nobel-physics.jpg',
    filename: 'dixit_nobel-physics.jpg',
    caption: 'Nobel Prize in Physics Ceremony',
    size: 'regular' // Takes ~50% of column height
  },
  {
    src: '/highlights/judd-apatow.jpg',
    filename: 'judd-apatow.jpg', 
    caption: 'Judd Apatow',
    size: 'regular' // Takes ~50% of column height
  },
  
  // Column 2 - Middle (1 tall central portrait)
  {
    src: '/highlights/vanessa-kirby.jpg',
    filename: 'vanessa-kirby.jpg',
    caption: 'Vanessa Kirby',
    size: 'wide_tall' // 4x size - dominant image spanning 2x2
  },
  
  // Column 3 - Right (3 stacked images)
  {
    src: '/highlights/Lisa_Gilroy_at_SXSW_in_2025-1.jpg',
    filename: 'Lisa_Gilroy_at_SXSW_in_2025-1.jpg',
    caption: 'Lisa Gilroy at SXSW in 2025',
    size: 'wide' // Landscape orientation
  },
  {
    src: '/highlights/jeremy.jpg',
    filename: 'jeremy.jpg',
    caption: 'Jeremy Strong',
    size: 'regular' // Portrait, middle of right stack
  },
  {
    src: '/highlights/jeremy-3.jpg',
    filename: 'jeremy-3.jpg',
    caption: 'Jeremy Strong',
    size: 'regular' // Portrait, bottom of right stack
  },
  
  // Column 4 continuation
  {
    src: '/highlights/jay-dixit_red-carpet_01130.jpg',
    filename: 'jay-dixit_red-carpet_01130.jpg',
    caption: 'Jay Dixit on the Red Carpet',
    size: 'wide_tall' // 4x size - another dominant image
  },
  
  // Continue with rest of photos
  {
    src: '/highlights/jeremy-11.jpg',
    filename: 'jeremy-11.jpg',
    caption: 'Jeremy',
    size: 'regular'
  },
  {
    src: '/highlights/vinod.jpg',
    filename: 'vinod.jpg',
    caption: 'Vinod',
    size: 'regular'
  },
  {
    src: '/highlights/conan.jpg',
    filename: 'conan.jpg',
    caption: 'Conan O\'Brien',
    size: 'regular'
  },
  {
    src: '/highlights/jay-dixit_red-carpet_05923-1.jpg',
    filename: 'jay-dixit_red-carpet_05923-1.jpg',
    caption: 'Jay Dixit Red Carpet',
    size: 'regular'
  },
  {
    src: '/highlights/jeremy-6.jpg',
    filename: 'jeremy-6.jpg',
    caption: 'Jeremy',
    size: 'regular'
  },
  {
    src: '/highlights/jeremy-4.jpg',
    filename: 'jeremy-4.jpg',
    caption: 'Jeremy',
    size: 'regular'
  },
  {
    src: '/highlights/vinod-4.jpg',
    filename: 'vinod-4.jpg',
    caption: 'Vinod',
    size: 'regular'
  }
];
---

<MainLayout>
  <div class="portfolio-wrap">
    <div class="portfolio-items masonry-items" data-masonry-type="photography">
      {highlightPhotos.map((photo, index) => (
        <div class={`col elastic-portfolio-item ${photo.size}`} data-delay-amount={index}>
          <div class="inner-wrap">
            <div class="work-item">
              <a href={photo.src} data-gallery="main-gallery">
                <img 
                  src={photo.src} 
                  alt={photo.caption}
                  loading="lazy"
                />
              </a>
              <div class="work-info-bg"></div>
              <div class="work-info">
                <h3>{photo.caption}</h3>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</MainLayout>

<style>
/* Portfolio container - full width */
.portfolio-wrap {
  position: relative;
  margin: 0;
  padding: 0;
  width: 100%;
}

/* Masonry Container - full width */
.portfolio-items {
  position: relative;
  width: 100%;
  margin: 0;
  padding: 0;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.portfolio-items.isotope-initialized {
  opacity: 1;
}

/* Base column width - 3 column layout as per WordPress site */
.portfolio-items .col {
  width: 33.333%; /* 3 columns base */
  padding: 2px; /* Minimal gap between photos */
  box-sizing: border-box;
}

/* Size variations matching Salient Photography mode */
.portfolio-items .col.regular {
  width: 33.333%; /* 1 column width */
}

.portfolio-items .col.wide {
  width: 66.666%; /* 2 columns width - landscape */
}

.portfolio-items .col.tall {
  width: 33.333%; /* 1 column width but taller */
}

.portfolio-items .col.wide_tall {
  width: 66.666%; /* 2 columns width, 2x height - dominant 4x images */
}

/* Responsive breakpoints */
@media only screen and (max-width: 990px) {
  .portfolio-items .col,
  .portfolio-items .col.regular,
  .portfolio-items .col.tall {
    width: 50%; /* 2 columns */
  }
  .portfolio-items .col.wide,
  .portfolio-items .col.wide_tall {
    width: 100%; /* Full width on smaller screens */
  }
}

@media only screen and (max-width: 690px) {
  .portfolio-items .col,
  .portfolio-items .col.regular,
  .portfolio-items .col.wide,
  .portfolio-items .col.tall,
  .portfolio-items .col.wide_tall {
    width: 100%; /* 1 column on mobile */
  }
}

/* Inner wrapper */
.portfolio-items .col .inner-wrap {
  position: relative;
  overflow: hidden;
  background: #f5f5f5;
}

/* Work item container */
.portfolio-items .col .work-item {
  position: relative;
  overflow: hidden;
  cursor: pointer;
}

/* Images - maintain aspect ratio */
.portfolio-items .col img {
  width: 100%;
  height: auto;
  display: block;
  transition: transform 0.45s cubic-bezier(0.3, 0.1, 0.3, 1);
}

/* Hover effects */
.portfolio-items .col:hover img {
  transform: scale(1.07);
}

/* Work info overlay */
.portfolio-items .work-info-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0);
  transition: background 0.45s ease;
  pointer-events: none;
}

.portfolio-items .col:hover .work-info-bg {
  background: rgba(0, 0, 0, 0.4);
}

.portfolio-items .work-info {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 20px;
  color: #fff;
  transform: translateY(100%);
  transition: transform 0.45s cubic-bezier(0.3, 0.1, 0.3, 1);
}

.portfolio-items .col:hover .work-info {
  transform: translateY(0);
}

.portfolio-items .work-info h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 400;
}

/* Animation */
@keyframes portfolioFadeIn {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.portfolio-items .col .inner-wrap {
  animation: portfolioFadeIn 0.6s ease forwards;
  opacity: 0;
}

.portfolio-items.animated-in .col .inner-wrap {
  opacity: 1;
}

/* Staggered animation */
.portfolio-items .col:nth-child(1) .inner-wrap { animation-delay: 0ms; }
.portfolio-items .col:nth-child(2) .inner-wrap { animation-delay: 85ms; }
.portfolio-items .col:nth-child(3) .inner-wrap { animation-delay: 170ms; }
.portfolio-items .col:nth-child(4) .inner-wrap { animation-delay: 255ms; }
.portfolio-items .col:nth-child(5) .inner-wrap { animation-delay: 340ms; }
.portfolio-items .col:nth-child(6) .inner-wrap { animation-delay: 425ms; }
.portfolio-items .col:nth-child(7) .inner-wrap { animation-delay: 510ms; }
.portfolio-items .col:nth-child(8) .inner-wrap { animation-delay: 595ms; }
</style>

<!-- Load Isotope and required libraries -->
<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>

<script>
  import GLightbox from 'glightbox';
  
  document.addEventListener('DOMContentLoaded', function() {
    const container = document.querySelector('.portfolio-items');
    
    // Initialize GLightbox
    const lightbox = GLightbox({
      selector: '[data-gallery="main-gallery"]',
      touchNavigation: true,
      loop: true,
      autoplayVideos: false,
      zoomable: true,
      draggable: true,
    });
    
    // Wait for images to load, then initialize Isotope
    imagesLoaded(container, function() {
      // Initialize Isotope for masonry layout with mixed sizes
      const iso = new Isotope(container, {
        itemSelector: '.col',
        layoutMode: 'masonry',
        masonry: {
          columnWidth: '.col.regular', // Use regular size as base unit
          gutter: 0
        },
        percentPosition: false,
        transitionDuration: '0.3s',
        hiddenStyle: {
          opacity: 0,
          transform: 'translateY(30px)'
        },
        visibleStyle: {
          opacity: 1,
          transform: 'translateY(0)'
        }
      });
      
      // Add initialized class
      container.classList.add('isotope-initialized');
      
      // Trigger animation
      setTimeout(() => {
        container.classList.add('animated-in');
      }, 100);
      
      // Handle window resize
      let resizeTimer;
      window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
          iso.layout();
        }, 250);
      });
    });
  });
</script>
